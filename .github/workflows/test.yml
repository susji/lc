name: Test

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  test:
    env:
      ASAN_OPTIONS: detect_leaks=0
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
      - name: get deps
        run: sudo apt-get install gcc-multilib
      - name: compile lc0 with OS-provided compiler
        run: make lc0
      - name: compilation tests
        run: make test
      - name: compile lc1 with lc0
        run: make lc1
      - name: compile lc with lc1
        run: make lc
      - name: compare results
        run: |
          diff out.s.lc0 out.s.lc1
          sha256sum out.s.*
